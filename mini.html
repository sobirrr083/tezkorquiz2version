<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tezkor Quiz</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
      --dark: #212529;
      --light: #f8f9fa;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Nunito', 'Roboto', sans-serif;
      background: #ECF2FF;
      padding-top: 80px;
      min-height: 100vh;
    }

    /* NAVBAR */
    .navbar {
      padding: 16px 0;
      background: rgba(255,255,255,1);
      box-shadow: 0 2px 10px rgba(0,0,0,.05);
      transition: all .4s ease;
    }
    .navbar.scrolled {
      padding: 8px 0;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,.12);
    }
    .navbar-brand {
      font-weight: 800;
      font-size: 28px;
      color: var(--primary) !important;
    }
    .nav-link {
      font-weight: 600;
      color: var(--dark) !important;
      border-radius: 12px;
      padding: 10px 20px !important;
      transition: .3s;
    }
    .nav-link:hover { color: var(--primary) !important; }
    .nav-link.active {
      background: var(--gradient);
      color: #fff !important;
    }

    /* BURGER */
    .burger {
      width: 26px; height: 20px; cursor: pointer; display: none;
    }
    .burger span {
      display: block; height: 2.5px; width: 100%; background: #000;
      border-radius: 8px; transition: .3s; position: absolute;
    }
    .burger span:nth-child(1) { top: 0; }
    .burger span:nth-child(2) { top: 50%; transform: translateY(-50%); }
    .burger span:nth-child(3) { bottom: 0; }
    #burger:checked ~ span:nth-child(1) { transform: rotate(45deg); top: 8px; }
    #burger:checked ~ span:nth-child(2) { opacity: 0; }
    #burger:checked ~ span:nth-child(3) { transform: rotate(-45deg); bottom: 8px; }

    /* PROFIL BUTTON */
    .profile-btn {
      width: 44px; height: 44px; border-radius: 50%;
      background: var(--gradient); display: flex;
      align-items: center; justify-content: center;
      cursor: pointer; box-shadow: 0 4px 15px rgba(67,97,238,.4);
      transition: .3s;
    }
    .profile-btn:hover { transform: scale(1.1); }
    .profile-btn img, .profile-btn svg {
      width: 26px; height: 26px; color: #fff;
    }

    /* DROPDOWN */
    .profile-dropdown {
      position: absolute; top: 70px; right: 15px;
      width: 290px; background: #fff; border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,.15);
      opacity: 0; visibility: hidden; transform: translateY(-10px);
      transition: .3s; z-index: 999;
    }
    .profile-dropdown.show {
      opacity: 1; visibility: visible; transform: translateY(0);
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 2000; opacity: 0; visibility: hidden; transition: .3s;
    }
    .modal-backdrop.show { opacity: 1; visibility: visible; }
    .modal {
      background: #fff; border-radius: 16px; padding: 24px;
      max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,.2);
      transform: scale(.9); transition: .3s;
    }
    .modal.show { transform: scale(1); }

    /* RESPONSIVE */
    @media (max-width: 991px) {
      .burger { display: block; }
      .navbar-collapse {
        position: fixed; top: 65px; left: 0; width: 100%; height: calc(100vh - 65px);
        background: #fff; padding: 20px; transform: translateX(-100%);
        transition: .4s; overflow-y: auto;
      }
      .navbar-collapse.show { transform: translateX(0); }
      .nav-link { width: 100%; margin: 5px 0; }
    }
  </style>
</head>
<body>

<nav class="navbar fixed-top" id="mainNav">
  <div class="container d-flex align-items-center justify-content-between">

    <!-- LOGO -->
    <a class="navbar-brand" href="#">Tezkor Quiz</a>

    <!-- MOBIL PROFIL (burger chapida) -->
    <div id="mobileProfile" class="me-3 d-lg-none"></div>

    <!-- BURGER -->
    <label class="burger" for="burger">
      <input type="checkbox" id="burger" hidden />
      <span></span><span></span><span></span>
    </label>

    <!-- MENU -->
    <div class="collapse navbar-collapse" id="navCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="#">Bosh sahifa</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Segment</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Aloqa</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            Testni boshlash
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Tezkor Quiz</a></li>
            <li><a class="dropdown-item" href="#">Bilim Quiz</a></li>
            <li><a class="dropdown-item" href="#">Smart Quiz</a></li>
            <li><a class="dropdown-item" href="#">Pro Quiz</a></li>
            <li><a class="dropdown-item" href="#">Imtihon Quiz</a></li>
          </ul>
        </li>
      </ul>

      <!-- DESKTOP PROFIL (dropdown o‘ngida) -->
      <div id="desktopProfile" class="d-none d-lg-block ms-3"></div>
    </div>
  </div>
</nav>

<!-- PROFIL DROPDOWN -->
<div id="profileDropdown" class="profile-dropdown"></div>

<!-- LOGOUT MODAL -->
<div id="logoutModal" class="modal-backdrop">
  <div class="modal">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="m-0">Chiqish</h5>
      <button id="closeModal" class="btn p-0"><i class="fas fa-times"></i></button>
    </div>
    <p>Haqiqatan ham tizimdan chiqmoqchimisiz?</p>
    <div class="d-flex gap-2 mt-4">
      <button id="cancelLogout" class="btn btn-secondary flex-fill">Bekor qilish</button>
      <button id="confirmLogout" class="btn btn-danger flex-fill">
        <span>Chiqish</span>
      </button>
    </div>
  </div>
</div>

<!-- Demo content -->
<div class="container my-5">
  <div class="p-5 bg-white rounded shadow">
    <h2 class="text-center">Scroll qiling → navbar blur bo‘ladi</h2>
    <p class="text-center lead">Profil → Kirish → Chiqish – hammasi ishlaydi!</p>
  </div>
</div>

<!-- Firebase + Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword,
           createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxIpLY5WasiSIlDL4japBLnnXRwOLUKEQ",
      authDomain: "tezkor-quiz-bbe3c.firebaseapp.com",
      projectId: "tezkor-quiz-bbe3c",
      storageBucket: "tezkor-quiz-bbe3c.firebasestorage.app",
      messagingSenderId: "143161522496",
      appId: "1:143161522496:web:252108ace3a4c19f35e2a5",
    };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const desktop = document.getElementById('desktopProfile');
  const mobile  = document.getElementById('mobileProfile');
  const dropdown = document.getElementById('profileDropdown');
  const modal = document.getElementById('logoutModal');
  const closeBtn = document.getElementById('closeModal');
  const cancelBtn = document.getElementById('cancelLogout');
  const confirmBtn = document.getElementById('confirmLogout');

  // Profil tugmasini yaratish
  function renderBtn(user) {
    const photo = user?.photoURL || '';
    const html = photo
      ? `<img src="${photo}" class="rounded-circle" />`
      : `<i data-lucide="user"></i>`;
    const btn = `<button class="profile-btn">${html}</button>`;
    desktop.innerHTML = btn;
    mobile.innerHTML = btn;
    lucide.createIcons();

    document.querySelectorAll('.profile-btn').forEach(b =>
      b.onclick = () => dropdown.classList.toggle('show')
    );
  }

  // Dropdown ichidagi ma'lumot
  function renderDropdown(user) {
    dropdown.innerHTML = `
      <div class="p-4 border-bottom">
        <div class="d-flex align-items-center gap-3">
          ${user.photoURL
            ? `<img src="${user.photoURL}" class="rounded-circle" width="48" height="48"/>`
            : `<div class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white" style="width:48px;height:48px;">
                 <i data-lucide="user" style="width:28px;height:28px;"></i>
               </div>`}
          <div>
            <div class="fw-bold">${user.displayName || 'Foydalanuvchi'}</div>
            <small class="text-muted">${user.email}</small>
          </div>
        </div>
      </div>
      <button id="logoutBtn" class="w-100 text-start px-4 py-3 text-danger hover-bg-danger">
        <i data-lucide="log-out" class="me-2"></i> Chiqish
      </button>
    `;
    lucide.createIcons();
    document.getElementById('logoutBtn').onclick = () => {
      dropdown.classList.remove('show');
      modal.classList.add('show');
      modal.querySelector('.modal').classList.add('show');
    };
  }

  // Kirish prompti
  function showLogin() {
    const btn = `<button class="profile-btn"><i data-lucide="log-in"></i></button>`;
    desktop.innerHTML = mobile.innerHTML = btn;
    lucide.createIcons();
    document.querySelectorAll('.profile-btn').forEach(b => b.onclick = loginPrompt);
  }

  function loginPrompt() {
    const email = prompt('Email kiriting:');
    const pass  = prompt('Parol kiriting:');
    if (!email || !pass) return;

    signInWithEmailAndPassword(auth, email, pass)
      .catch(err => {
        if (err.code === 'auth/user-not-found') {
          if (confirm('Bunday foydalanuvchi topilmadi. Roʻyxatdan oʻtmoqchimisiz?')) {
            createUserWithEmailAndPassword(auth, email, pass)
              .catch(e => alert(e.message));
          }
        } else {
          alert(err.message);
        }
      });
  }

  // Foydalanuvchi holati
  onAuthStateChanged(auth, user => {
    if (user) {
      renderBtn(user);
      renderDropdown(user);
    } else {
      showLogin();
      dropdown.innerHTML = '';
    }
  });

  // Modal yopish
  [closeBtn, cancelBtn].forEach(b => b.onclick = () => {
    modal.classList.remove('show');
    modal.querySelector('.modal').classList.remove('show');
  });

  // Chiqish
  confirmBtn.onclick = () => {
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Chiqish...';
    signOut(auth)
      .then(() => location.reload())
      .catch(err => {
        alert('Chiqishda xato: ' + err.message);
        confirmBtn.disabled = false;
        confirmBtn.innerHTML = 'Chiqish';
      });
  };

  // Tashqarida bosilganda dropdown yopish
  document.addEventListener('click', e => {
    if (!e.target.closest('.profile-btn') && !e.target.closest('.profile-dropdown')) {
      dropdown.classList.remove('show');
    }
  });

  // Navbar scroll blur
  window.addEventListener('scroll', () => {
    document.getElementById('mainNav').classList.toggle('scrolled', scrollY > 30);
  });

  // Mobil menu
  document.getElementById('burger').addEventListener('change', e => {
    document.getElementById('navCollapse').classList.toggle('show', e.target.checked);
    document.body.style.overflow = e.target.checked ? 'hidden' : '';
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
